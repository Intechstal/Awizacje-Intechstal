<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel Admina - Awizacje</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #eee; }
  input, select { width: 100%; box-sizing: border-box; }
  button { padding: 5px 10px; margin: 2px; }
  a { margin: 0 5px; text-decoration: none; color: blue; }
  a:hover { text-decoration: underline; }

  /* Kolory slotów w kalendarzu */
  .slot {
    display: inline-block;
    width: 100px;
    padding: 5px;
    margin: 2px;
    border: 1px solid #aaa;
    border-radius: 4px;
    font-size: 0.9em;
    cursor: default;
  }
  .slot.free {
    background-color: #f9f9f9;
    color: #555;
  }
  .slot.occupied-oczekujaca {
    background-color: #f8d7da; /* jasny czerwony */
    color: #721c24;
  }
  .slot.occupied-zaakceptowana {
    background-color: #d4edda; /* jasny zielony */
    color: #155724;
  }
</style>
</head>
<body>

<h1>Panel Admina - Awizacje</h1>

<h2>Kalendarz awizacji (sloty co 15 min)</h2>

{% for dzien in dni %}
  <h3>{{ dzien.strftime("%A, %d.%m.%Y") }}</h3>
  <div>
    {% for godz in godziny %}
      {% set full_dt = dzien.strftime("%Y-%m-%d") + 'T' + godz.strftime("%H:%M") %}
      {% if full_dt in zajete %}
        {% set z = zajete[full_dt] %}
        <div class="slot occupied-{{ z.status }}">{{ godz.strftime("%H:%M") }}<br>{{ z.firma }}</div>
      {% else %}
        <div class="slot free">{{ godz.strftime("%H:%M") }}</div>
      {% endif %}
    {% endfor %}
  </div>
{% endfor %}

<h2>Lista awizacji</h2>

<table>
  <thead>
    <tr>
      <th>Firma</th>
      <th>Rejestracja</th>
      <th>Kierowca</th>
      <th>Email</th>
      <th>Telefon</th>
      <th>Data i godzina</th>
      <th>Typ ładunku</th>
      <th>Waga ładunku</th>
      <th>Komentarz</th>
      <th>Status</th>
      <th>Akcje</th>
    </tr>
  </thead>
  <tbody>
  {% for a in awizacje %}
    <tr>
      <form method="POST" action="/admin/edit/{{ a[0] }}">
        <td><input type="text" name="firma" value="{{ a[1] }}" required></td>
        <td><input type="text" name="rejestracja" value="{{ a[2] }}" required></td>
        <td><input type="text" name="kierowca" value="{{ a[3] }}" required></td>
        <td><input type="email" name="email" value="{{ a[4] }}"></td>
        <td><input type="text" name="telefon" value="{{ a[5] }}"></td>
        <td><input type="datetime-local" name="data_godzina" value="{{ a[6] }}"></td>
        <td><input type="text" name="typ_ladunku" value="{{ a[7] }}"></td>
        <td><input type="text" name="waga_ladunku" value="{{ a[8] }}"></td>
        <td><input type="text" name="komentarz" value="{{ a[9] }}"></td>
        <td>
          <select name="status">
            <option value="oczekująca" {% if a[10] == 'oczekująca' %}selected{% endif %}>Oczekująca</option>
            <option value="zaakceptowana" {% if a[10] == 'zaakceptowana' %}selected{% endif %}>Zaakceptowana</option>
          </select>
        </td>
        <td>
          <button type="submit">Zapisz</button><br>
          <a href="/admin/accept/{{ a[0] }}">Zaakceptuj</a> | 
          <a href="/admin/reject/{{ a[0] }}" onclick="return confirm('Na pewno usunąć awizację?')">Usuń</a>
        </td>
      </form>
    </tr>
  {% endfor %}
  </tbody>
</table>

</body>
</html>
